<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>專業氣質探索之旅 ✨</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; color: #333; }
        .question { display: none; } /* 預設隱藏，一題題顯示 */
        .question.active { display: block; }
        button { display: block; width: 100%; margin: 10px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: #fff; cursor: pointer; transition: 0.3s; }
        button:hover { background: #f9f9f9; border-color: #aaa; }
    </style>
</head>
<body>

    <div id="quiz-container">
        <div id="q1" class="question active">
            <h3>Q1：當你開啟對話，你最想傳遞？📖</h3>
            <button onclick="nextStep('q1', 'q2', 'A')">(A) 真實且溫暖的故事 ☕</button>
            <button onclick="nextStep('q1', 'q2', 'B')">(B) 紮實且精準的洞察 🔍</button>
            <button onclick="nextStep('q1', 'q2', 'C')">(C) 共同探索未來的提問 🌈</button>
            <button onclick="nextStep('q1', 'q2', 'D')">(D) 讓人安定的誠意 🛡️</button>
        </div>

        <div id="q2" class="question">
            <h3>Q2：你最引以為傲的專業氣質？🌿</h3>
            <button onclick="nextStep('q2', 'q3', 'A')">(A) 冬日暖陽般的感應 ☀️</button>
            <button onclick="nextStep('q2', 'q3', 'B')">(B) 山間清泉般的化繁為簡 💧</button>
            <button onclick="nextStep('q2', 'q3', 'C')">(C) 浩瀚星空般的視野 ✨</button>
            <button onclick="nextStep('q2', 'q3', 'D')">(D) 紮實大地般的支撐 ⛰️</button>
        </div>

        <div id="q3" class="question">
            <h3>Q3：理想中的專業互動面貌？🤝</h3>
            <button onclick="nextStep('q3', 'q4', 'A')">(A) 生命價值的交會 🫂</button>
            <button onclick="nextStep('q3', 'q4', 'B')">(B) 解決真正的痛點 🎯</button>
            <button onclick="nextStep('q3', 'q4', 'C')">(C) 激盪靈感的啟發 💡</button>
            <button onclick="nextStep('q3', 'q4', 'D')">(D) 溫柔的靜靜聆聽 👂</button>
        </div>

        <div id="q4" class="question">
            <h3>Q4：希望來賓心裡留下的感覺？🌻</h3>
            <button onclick="finish('q4', 'A')">(A) 感覺被理解了 ❤️</button>
            <button onclick="finish('q4', 'B')">(B) 觀點值得深聊 🛋️</button>
            <button onclick="finish('q4', 'C')">(C) 專業的能量 🚀</button>
            <button onclick="finish('q4', 'D')">(D) 難得的誠懇 🙏</button>
        </div>

        <div id="loading" style="display:none;">正在為你傳遞這份誠心... 🕊️</div>
    </div>

<script>
    let results = [];

// 💡 修改您的 main 函式，增加一個環境檢查
async function main() {
    // 檢查網址參數，如果不是從 LINE 開啟，就不執行初始化
    const urlParams = new URLSearchParams(window.location.search);
    const isLiffStart = urlParams.has('liff.state') || navigator.userAgent.includes('Line');

    if (!isLiffStart) {
        console.log("偵測到非 LINE 環境，為了維持呼吸感，暫不啟動 LIFF 引擎 🌿");
        return; 
    }

    try {
        await liff.init({ liffId: "2008852500-T0YTrryy" });
        // ...其餘登入邏輯
    } catch (err) {
        console.error("初始化失敗", err);
    }
}    main();

    function nextStep(currentId, nextId, choice) {
        results.push(choice);
        document.getElementById(currentId).classList.remove('active');
        document.getElementById(nextId).classList.add('active');
    }

async function finish(currentId, choice) {
        results.push(choice);
        document.getElementById(currentId).style.display = 'none';
        document.getElementById('loading').style.display = 'block';

        const finalScore = results.join("");
        const gasUrl = "https://script.google.com/macros/s/AKfycbxCY1O95HjRMLzWRUZ6qc_rlaxZ0h4d4HnlXkfq5O6t8PK08rIAvhoVQmfhcR8IsR4r/exec";

        try {
            // 先發送資料
            fetch(gasUrl, {
                method: "POST",
                body: JSON.stringify({ result: finalScore }),
                mode: 'no-cors'
            });

            // 稍微停頓 0.5 秒，給瀏覽器一點緩衝時間
            setTimeout(() => {
                alert("✨ 探索完成 ✨\n感謝您的參與，這份誠摯的選擇已傳達。🌿");
                // 嘗試關閉視窗，如果無效則導向您的官方帳號
                if (liff.isInClient()) {
                    liff.closeWindow();
                } else {
                    window.location.href = "https://line.me/R/ti/p/@309fyvuw"; // 導向您的 LINE@
                }
            }, 500);

        } catch (error) {
            console.error(error);
            alert("完成！感謝您的參與喔！☕");
            liff.closeWindow();
        }
    }
</script>
</body>
</html>