<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>äººç”Ÿè½‰å½è™•ï½œå¤©è³¦æ•¸å­—äº’å‹•é«”é©—</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
/* ä¿æŒæ‚¨å„ªé›…çš„æ²™é¾é¢¨æ ¼ */
body{ margin:0; font-family:"Helvetica Neue", sans-serif; background:#f5f6f8; transition:background 0.8s; }
#wrapper{ min-height:100vh; display:flex; justify-content:center; align-items:center; }
#app{ width:360px; background:#fff; border-radius:26px; padding:26px; box-shadow:0 20px 50px rgba(0,0,0,.18); }
button{ width:100%; padding:14px; margin:8px 0; border-radius:14px; border:none; font-size:16px; cursor:pointer; background:#f0f0f0; transition: 0.3s; }
button:hover{ background:#e3edff; }
.fade{ animation: fadeIn 0.8s; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.qr{ width: 120px; margin-top: 15px; border-radius: 10px; }
.number-card-img{ width: 100%; border-radius: 18px; margin: 15px 0; }
</style>
</head>
<body>

<div id="wrapper">
  <div id="app" class="fade">
    <div id="content">
      <h3 style="color:#333;">ğŸŒ¿ è¼‰å…¥ä¸­...</h3>
      <p>æ­£åœ¨ç‚ºæ‚¨é–‹å•Ÿå°ˆå±¬çš„æ¢ç´¢ç©ºé–“</p>
    </div>
  </div>
</div>

<script>
// å„²å­˜ç‹€æ…‹
const state = {
    userName: "æœ‹å‹",
    userPic: "",
    deviceInfo: ""
};

// åˆå§‹åŒ– LIFF
async function main() {
    try {
        // ğŸ”‘ æ‚¨çš„æ–° LIFF ID
        await liff.init({ liffId: "2008876179-yvn4oUyo" }); 
        
        if (!liff.isLoggedIn()) {
            liff.login(); 
        } else {
            const profile = await liff.getProfile();
            state.userName = profile.displayName;
            state.userPic = profile.pictureUrl;
            state.deviceInfo = navigator.userAgent.match(/\(([^)]+)\)/) ? navigator.userAgent.match(/\(([^)]+)\)/)[1] : "æœªçŸ¥è£ç½®";
            showWelcome();
        }
    } catch (err) {
        document.getElementById('content').innerHTML = "<h3>ğŸ”Œ é–€éˆ´æš«æ™‚å¤±éˆ</h3><p>è«‹ç¢ºèªæ‚¨çš„ç¶²è·¯é€£ç·šï¼Œæˆ–ç¨å¾Œå†è©¦ã€‚</p>";
        console.error("LIFF Init Error", err);
    }
}

function showWelcome() {
    document.getElementById('content').innerHTML = `
        <h3 style="color:#2c3e50;">æ‚¨å¥½ï¼Œ${state.userName} â˜•</h3>
        <p>å¦‚æœèµ°åˆ°äººç”Ÿä¸€å€‹è½‰å½è™•ï¼Œ<br>
        æ‚¨æœƒæƒ³é‡è¦‹ä»€éº¼æ¨£çš„è‡ªå·±å‘¢ï¼Ÿâœ¨</p>
        <p class="small" style="color:#7f8c8d; font-size:14px;">ï¼ˆé»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹æ¢ç´¢å¤©è³¦æ•¸å­—ï¼‰</p>
        <button onclick="startQuiz()">ğŸ•¯ï¸ é–‹å§‹æ¢ç´¢</button>
    `;
}

function startQuiz() {
    const dob = prompt("è«‹è¼¸å…¥æ‚¨çš„åœ‹æ›†ç”Ÿæ—¥ (ä¾‹å¦‚: 19880101)", "");
    if (!dob || dob.length !== 8) {
        alert("è«‹è¼¸å…¥æ­£ç¢ºçš„ 8 ä½æ•¸ç”Ÿæ—¥ï¼Œè®“æˆ‘å€‘å°é½Šäº‹å¯¦ ğŸŒ¿");
        return;
    }
    processResult(dob);
}

function processResult(dob) {
    const digits = dob.split('').map(Number);
    let sum = digits.reduce((a, b) => a + b, 0);
    while (sum > 9) {
        sum = String(sum).split('').map(Number).reduce((a, b) => a + b, 0);
    }
    const n = sum;
    
    // ç°¡å–®å°æ‡‰æ¨™ç±¤ï¼ˆç¯„ä¾‹ï¼‰
    const traitsMap = {
        1: "é–‹å‰µã€ç¨ç«‹ã€é ˜å°åŠ›",
        2: "åˆä½œã€å’Œè«§ã€æ•æ„Ÿåº¦",
        3: "è¡¨é”ã€å‰µæ„ã€ç¤¾äº¤ç†±æƒ…",
        4: "ç©©å®šã€å®‰å…¨ã€çµ„ç¹”èƒ½åŠ›",
        5: "è‡ªç”±ã€è®ŠåŒ–ã€å†’éšªç²¾ç¥",
        6: "å¥‰ç»ã€è²¬ä»»ã€ç™‚ç™’æ°£è³ª",
        7: "åˆ†æã€ç›´è¦ºã€å°‹æ±‚çœŸç†",
        8: "æˆå°±ã€æ¬Šå¨ã€ç‰©è³ªæŒæ§",
        9: "æ…ˆæ‚²ã€æ™ºæ…§ã€å¤¢æƒ³ç²¾ç¥"
    };

    const traits = traitsMap[n];
    const blessing = "é¡˜æ‚¨åœ¨è½‰å½è™•ï¼Œçœ‹è¦‹æœ€é–ƒè€€çš„è‡ªå·±ã€‚";

    document.getElementById('content').innerHTML = `
        <h3 style="color:#333;">âœ¨ æ‚¨çš„å¤©è³¦æ•¸å­—æ˜¯ï¼š${n}</h3>
        <p>æ‚¨çš„å°ˆå±¬ç‰¹è³ªï¼š<strong>${traits}</strong></p>
        <img src="card${n}.jpg" class="number-card-img" alt="å¤©è³¦æ•¸å­—åœ–å¡">
        <p>æœŸå¾…æœ‰æ©ŸæœƒèŠèŠï¼Œè®“å°ˆæ¥­åƒ¹å€¼è¢«çœ‹è¦‹ ğŸŒ¿</p>
        <a href="https://better885.pse.is/Line2BetterHung" target="_blank" style="color:#3498db; text-decoration:none;">ğŸ“± é»æ­¤èˆ‡ Better è¯ç¹«</a><br>
        <img src="BetterQRCode.jpg" class="qr">
        <p style="font-size:12px; color:#bdc3c7; margin-top:20px;">2026/01/13 Ver 2.4</p>
    `;

    sendToBackstage(dob, n, traits, blessing);
}

async function sendToBackstage(dob, n, traits, blessing) {
    // ğŸ“Š æ‚¨çš„æ–° GAS URL
    const gasUrl = "https://script.google.com/macros/s/AKfycbxTtiszEm7cwaCPy1IrB3u0D6CuxW1vmGjqfuF4actXCS2gxjeAeP5449n7I2n9gQZv/exec";

    // ä½¿ç”¨æ¥µåº¦è±å¯Œçš„è¡¨æƒ…è²¼æ‰¿è¼‰æƒ…ç·’
    const fullReport = `
ğŸŒ¿ ã€æ•¸ä½æ²™é¾ï½œå¤©è³¦å ±å‘Šã€‘ ğŸŒ¿

ğŸ‘¤ ä¾†è³“ï¼š${state.userName} å…ˆç”Ÿ/å°å§
ğŸ”¢ æ ¸å¿ƒæ•¸å­—ï¼š${n} è™Ÿäºº
âœ¨ ç‰¹è³ªæ¨™ç±¤ï¼š${traits}
ğŸ“… ç´€éŒ„ç”Ÿæ—¥ï¼š${dob}

---------------------------
ğŸ’¡ æ¢ç´¢ç­†è¨˜ï¼š
${blessing}
---------------------------

ğŸ“± ä¾†æºè¨­å‚™ï¼š${state.deviceInfo}
ğŸ–¼ï¸ ä¾†è³“é ­åƒï¼š${state.userPic}

ğŸ’Œ é€™æ˜¯ä¸€ä»½å€¼å¾—åä¸‹ä¾†è½ 5 åˆ†é˜çš„å°ˆæ¥­åƒ¹å€¼ã€‚
    `.trim();

    fetch(gasUrl, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            userName: state.userName,
            dob: dob,
            lifeNumber: n,
            traits: traits,
            fullReport: fullReport
        })
    });
}

main();
</script>
</body>
</html>