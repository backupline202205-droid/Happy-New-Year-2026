<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å°ˆæ¥­æ°£è³ªæ¢ç´¢ä¹‹æ—… âœ¨</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; color: #333; }
        .question { display: none; } /* é è¨­éš±è—ï¼Œä¸€é¡Œé¡Œé¡¯ç¤º */
        .question.active { display: block; }
        button { display: block; width: 100%; margin: 10px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: #fff; cursor: pointer; transition: 0.3s; }
        button:hover { background: #f9f9f9; border-color: #aaa; }
    </style>
</head>
<body>

    <div id="quiz-container">
        <div id="q1" class="question active">
            <h3>Q1ï¼šç•¶ä½ é–‹å•Ÿå°è©±ï¼Œä½ æœ€æƒ³å‚³éï¼ŸğŸ“–</h3>
            <button onclick="nextStep('q1', 'q2', 'A')">(A) çœŸå¯¦ä¸”æº«æš–çš„æ•…äº‹ â˜•</button>
            <button onclick="nextStep('q1', 'q2', 'B')">(B) ç´®å¯¦ä¸”ç²¾æº–çš„æ´å¯Ÿ ğŸ”</button>
            <button onclick="nextStep('q1', 'q2', 'C')">(C) å…±åŒæ¢ç´¢æœªä¾†çš„æå• ğŸŒˆ</button>
            <button onclick="nextStep('q1', 'q2', 'D')">(D) è®“äººå®‰å®šçš„èª æ„ ğŸ›¡ï¸</button>
        </div>

        <div id="q2" class="question">
            <h3>Q2ï¼šä½ æœ€å¼•ä»¥ç‚ºå‚²çš„å°ˆæ¥­æ°£è³ªï¼ŸğŸŒ¿</h3>
            <button onclick="nextStep('q2', 'q3', 'A')">(A) å†¬æ—¥æš–é™½èˆ¬çš„æ„Ÿæ‡‰ â˜€ï¸</button>
            <button onclick="nextStep('q2', 'q3', 'B')">(B) å±±é–“æ¸…æ³‰èˆ¬çš„åŒ–ç¹ç‚ºç°¡ ğŸ’§</button>
            <button onclick="nextStep('q2', 'q3', 'C')">(C) æµ©ç€šæ˜Ÿç©ºèˆ¬çš„è¦–é‡ âœ¨</button>
            <button onclick="nextStep('q2', 'q3', 'D')">(D) ç´®å¯¦å¤§åœ°èˆ¬çš„æ”¯æ’ â›°ï¸</button>
        </div>

        <div id="q3" class="question">
            <h3>Q3ï¼šç†æƒ³ä¸­çš„å°ˆæ¥­äº’å‹•é¢è²Œï¼ŸğŸ¤</h3>
            <button onclick="nextStep('q3', 'q4', 'A')">(A) ç”Ÿå‘½åƒ¹å€¼çš„äº¤æœƒ ğŸ«‚</button>
            <button onclick="nextStep('q3', 'q4', 'B')">(B) è§£æ±ºçœŸæ­£çš„ç—›é» ğŸ¯</button>
            <button onclick="nextStep('q3', 'q4', 'C')">(C) æ¿€ç›ªéˆæ„Ÿçš„å•Ÿç™¼ ğŸ’¡</button>
            <button onclick="nextStep('q3', 'q4', 'D')">(D) æº«æŸ”çš„éœéœè†è½ ğŸ‘‚</button>
        </div>

        <div id="q4" class="question">
            <h3>Q4ï¼šå¸Œæœ›ä¾†è³“å¿ƒè£¡ç•™ä¸‹çš„æ„Ÿè¦ºï¼ŸğŸŒ»</h3>
            <button onclick="finish('q4', 'A')">(A) æ„Ÿè¦ºè¢«ç†è§£äº† â¤ï¸</button>
            <button onclick="finish('q4', 'B')">(B) è§€é»å€¼å¾—æ·±èŠ ğŸ›‹ï¸</button>
            <button onclick="finish('q4', 'C')">(C) å°ˆæ¥­çš„èƒ½é‡ ğŸš€</button>
            <button onclick="finish('q4', 'D')">(D) é›£å¾—çš„èª æ‡‡ ğŸ™</button>
        </div>

        <div id="loading" style="display:none;">æ­£åœ¨ç‚ºä½ å‚³éé€™ä»½èª å¿ƒ... ğŸ•Šï¸</div>
    </div>

 <script>
    let results = [];

    // 1. åˆå§‹åŒ– LIFF
async function main() {
    try {
        await liff.init({ 
            liffId: "2008852500-T0YTrryy",
            withLoginOnExternalBrowser: true 
        });

        if (!liff.isLoggedIn()) {
            // å¼·åˆ¶è¦æ±‚é€™ä¸‰å€‹æ¬Šé™
            liff.login({ scope: "profile,openid,chat_message.write" });
        } else {
            const context = liff.getContext();
            // 2026 æœ€æ–°æª¢æŸ¥ï¼šå¦‚æœç™¼ç¾ç•¶å‰ç™»å…¥æ²’æœ‰åŒ…å« chat_message.writeï¼Œå¼·åˆ¶ç™»å‡ºé‡æ–°ä¾†
            if (!context.scope || !context.scope.includes("chat_message.write")) {
                console.log("åµæ¸¬åˆ°æ¬Šé™ä¸è¶³ï¼Œæ­£åœ¨é‡æ–°è¦æ±‚æˆæ¬Š...");
                liff.logout(); 
                liff.login({ scope: "profile,openid,chat_message.write" });
            }
        }
    } catch (err) {
        alert("åˆå§‹åŒ–å¤±æ•—ï¼š" + (err.code || err.message));
    }
}

    main();

    function nextStep(currentId, nextId, choice) {
        results.push(choice);
        document.getElementById(currentId).classList.remove('active');
        document.getElementById(nextId).classList.add('active');
    }

    async function finish(currentId, choice) {
        results.push(choice);
        document.getElementById(currentId).style.display = 'none';
        document.getElementById('loading').style.display = 'block';

        const finalScore = results.join("");
        
        // 2. åœ¨å‚³é€å‰å†æ¬¡ç¢ºèªæ¬Šé™
        if (!liff.isLoggedIn()) {
            alert("è«‹å…ˆå®Œæˆ LINE ç™»å…¥ã€‚");
            liff.login();
            return;
        }

        try {
            await liff.sendMessages([
                {
                    type: 'text',
                    text: `âœ¨ å°ˆæ¥­æ°£è³ªæ¢ç´¢å®Œæˆ âœ¨\n\næˆ‘çš„é¸æ“‡çµæœæ˜¯ï¼šã€${finalScore}ã€‘ ğŸˆ\n\næˆ‘å·²ç¶“æº–å‚™å¥½èˆ‡ä½ é–‹å•Ÿä¸€å ´ã€Œå€¼å¾—åä¸‹ä¾†è½ 5 åˆ†é˜ã€çš„èª æ‡‡å°è©±äº†ã€‚æœŸå¾…ä½ çš„å›è¦†ï¼â˜•ğŸŒ·`
                }
            ]);
            liff.closeWindow(); 
        } catch (error) {
            console.error('å‚³é€å¤±æ•—', error);
            // é€™è£¡æœƒé¡¯ç¤ºè©³ç´°éŒ¯èª¤ï¼Œå¦‚æœæ˜¯ 403ï¼Œä»£è¡¨ Scopes çœŸçš„æ²’å‹¾æˆ–æˆæ¬Šæ²’é
            alert("å‚³é€å¤±æ•—ï¼\néŒ¯èª¤ä»£ç¢¼ï¼š" + error.code + "\nè¨Šæ¯ï¼š" + error.message);
        }
    }
</script>
</body>
</html>